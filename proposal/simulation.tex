\فصل{شبیه‌سازی}

همانطور که در فصل \رجوع{فصل: بیان مسائل و رویکردهای حل مساله} به آن پرداختیم.
در راستای ارزیابی انتها به انتها یک شبکه \متن‌لاتین{LoRaWAN} یکی از راه‌های مورد استفاده در این پیشنهاد رساله،
بهره‌گیری از شبیه‌سازی است.
در این فصل قصد داریم به بررسی شبیه‌سازی‌های صورت گرفته در این پیشنهاد رساله بپردازیم.
این شبیه‌سازی‌ها در راستای ارزیابی پارامترهای تاخیر و نرخ از دست رفت بسته بر روی مدل ساده شده از مساله
ارزیابی لایه دسترسی \متن‌لاتین{LoRaWAN} از دروازه تا سرور شبکه و اپلیکیشن که در فصل \رجوع{فصل: بیان مسائل و رویکردهای حل مساله}
معرفی شد، صورت می‌گیرد.

\قسمت{ارزیابی کارایی سرور شبکه و اپلیکیشن \متن‌لاتین{LoRaWAN}}

در این شبیه‌سازی قصد داریم تعداد زیادی بسته در شرایط متفاوت برای سرور شبکه و اپلیکیشن \متن‌لاتین{LoRaWAN} ارسال کرده و
عملکرد آن‌ها را در این شرایط برای تاخیر و نرخ از دست دادن بسته‌ها ارزیابی کنیم.
سرور شبکه همانطور که در پژوهش \مرجع{Carvalho2018} اشاره شده بود، یکی از سنگین‌ترین محاسبات در پیاده‌سازی مرجع \متن‌لاتین{LoRaWAN} را برعهده دارد و این مورد به
اهمیت این شبیه‌سازی می‌افزاید.
برای این کار از پیاده‌سازی متن‌باز \متن‌لاتین{Chirpstack} (\مرجع{chirpstack}) که با زبان برنامه‌نویسی \متن‌لاتین{Go} توسعه داده شده است،
به عنوان سرور شبکه (نسخه $3.5.15$) و اپلیکیشن (نسخه $3.17.4$) استفاده کرده و بسته‌هایی را با ساختار مورد انتظار
\متن‌لاتین{Chirpstack} شبیه‌سازی و ارسال می‌کنیم و با این روش دروازه‌ها و اشیا متصل به آن‌ها را شبیه‌سازی می‌کنیم.
این پیاده‌سازی از سرور شبکه بسته‌ها را از دروازه به وسیله‌ی پروتکل \متن‌لاتین{MQTT} دریافت می‌کند و در این شبیه‌سازی ما بسته‌هایی با ساختار \متن‌لاتین{Chirpstack}
را با پروتکل \متن‌لاتین{MQTT} ارسال می‌کنیم. برای سرور \متن‌لاتین{MQTT} از سرور متن‌باز \متن‌لاتین{NATS} (\مرجع{nats}) (نسخه $2.7.3$)
که با زبان برنامه‌نویسی \متن‌لاتین{Go} توسعه داده شده است، استفاده کرده‌ایم.
در نسخه ۳ از پیاده‌سازی متن‌باز \متن‌لاتین{Chirpstack} برخلاف نسخه‌های پیشین برای ارتباط میان دروازه و سرور شبکه از کدگذاری \متن‌لاتین{ProtoBuf} استفاده شده است که یک
کدگذاری مشابه با \متن‌لاتین{JSON} (که در پژوهش \مرجع{Carvalho2018} برای انتقال داده میان دروازه و سرور شبکه استفاده می‌شد.) بوده اما برخلاف آن باینری است و سربار کمتری دارد.

تاخیر و نرخ دریافت بسته‌ها به صورت انتها به انتها محاسبه می‌شود و از همین رو بسته‌های ارسالی دوباره به واسطه‌ی پروتکل \متن‌لاتین{MQTT} اما اینبار از سرور اپلکیشن
دریافت می‌شوند و به این ترتیب می‌توان نرخ دریافت بسته و تاخیر انتها به انتها را محاسبه کرد. این فرآیند شامل انتقال داده تا سرور شبکه، از آنجا تا سرور اپلکیشن و در نهایت
دریافت آن از سرور اپلیکیشن است. از سوی دیگر مواردی مانند رمزگشایی بسته و بررسی یکپارچگی آن که در سرور شبکه و اپلیکیشن \متن‌لاتین{LoRaWAN} رخ می‌دهند در این فرآیند دیده می‌شوند.

برای رمزگشایی صحیح بسته و دریافت آن نیاز است
که شی در سامانه \متن‌لاتین{Chirpstack} ثبت شود. برای سادگی از فرآیند اتصال \متن‌لاتین{ABP} به جای \متن‌لاتین{OTAA} استفاده شد که در آن کلیدها از پیش
داخل شی قرار گرفته و ایستا هستند.
کیفیت سرویس مورد استفاده برای انتشار و اشتراک روی \متن‌لاتین{MQTT} مقدار ''۱`` است. الگوریتم نرخ‌داده تطبیق‌پذیر روی سرور شبکه غیرفعال است.
داده‌های اشیا در قالب پروتکل \متن‌لاتین{CBOR} شبیه‌سازی شده‌اند که البته زمان کدگذاری و کدگشایی آن در این شبیه‌سازی لحاظ نشده است.
پروتکل \متن‌لاتین{CBOR} به عنوان به عنوان کدگذاری انتها به انتها استفاده شده است، این کدگذاری در واقع میان گره تا اپلیکیشن استفاده می‌شود.
تمامی ارتباط‌ها از دروازه تا سرور شبکه، از سرور شبکه تا سرور اپلیکیشن و از سرور اپلیکیشن تا دریافت دوباره داده
بر روی بستر پشته پروتکلی \متن‌لاتین{TCP/IP} هستند.

با توجه به زمان‌های محاسبه شده در محک‌های اول و دوم که همه‌ی سرویس‌ها روی یک سرور پیاده‌سازی شده‌اند، اینطور به نظر می‌رسد که دقت زمانی در حد میلی‌ثانیه
برای این ارزیابی کفایت می‌کند، بنابراین می‌توان از \متن‌لاتین{NTP} برای یکسان‌سازی زمانی استفاده کرد که عدم قطعیت آن از مرتبه میلی‌ثانیه است \مرجع{Sherman2016}.

در تمامی محک‌ها، در صورتی که بسته‌ای از دست رفته باشد تنها برای محاسبه نرخ دریافت از آن استفاده شده است و در سایر محاسبات لحاظ نشده است.
برای اطمینان از نتایج، هر ارزیابی ۱۰ بار تکرار شده است و میانگین، بیشینه و کمینه این ارزیابی‌ها ارائه شده است. در هر محک، ۱۰۰۰ بسته توسط هر شی ارسال شده است.

همانطور که در پژوهش \مرجع{Gupta2017} بیان شده است ترافیک اینترنت اشیا را می‌توان به صورت کلی به سه دسته ترافیک دوره‌ای، ترافیک بر اثر رویداد و ترکیب این دو تقسیم کرد.
در این ارزیابی ما ترافیک بر اثر رویداد را در نظر گرفته‌ایم.
در اینترنت اشیا عموما دستگاه به صورت دوره‌ای بسته‌هایی با اندازه کوچک ارسال می‌کنند اما می‌توان سناریوهایی در نظر گرفت که در آن‌ها در یک بازه زمانی کوتاه
تعداد اشیا زیادی دست به ارسال می‌زنند که از همگامی زمانی و مکانی برخوردارند \مرجع{Gupta2017}.

\زیرقسمت{محک اول}

در این سناریو از یک ماشین مجازی با هشت پردازنده مجازی از پردازنده فیزیکی
\متن‌لاتین{AMD Ryzen Threadripper 1950X}
و ۱۶ گیگابایت حافظه استفاده شد.
در این شبیه‌سازی، یک دروازه و یک شی شبیه‌سازی شده است. فاصله میان ارسال داده‌ها از ۱ ثانیه تا ۱ میلی‌ثانیه تغییر می‌کند.
در این محک تمامی اجزای شبیه‌سازی روی یک ماشین مجازی اجرا شده‌اند.

در این سناریو همانطور که در شکل \رجوع{شکل: نرخ از دست رفتن بسته در ارزیابی کارایی سرور شبکه و اپلیکیشن LoRaWAN --- محک اول}
دیده می‌شود بسته‌ای از دست نرفته است و با وجود افزایش زمان تاخیر همه بسته‌ها دریافت شده‌اند.

پارامتر تاخیر میانگین، با رسیدن به نرخ ارسال ۱۰۰ بسته در ثانیه (فاصله ارسال ۱ میلی‌ثانیه) افزایش پیدا می‌کند و
تقریبا به ۱۷ و نیم ثانیه می‌رسد (شکل \رجوع{شکل: تاخیر میانگین در ارزیابی کارایی سرور شبکه و اپلیکیشن LoRaWAN --- محک اول}).
یکی از پارامترهای تاثیر گذار در تجربه کاربران، ۹۰ درصد بالای تاخیر است.
فاصله زیاد این مقدار از تاخیر میانگین باعث می‌شود تا بسته‌هایی وجود داشته باشند که تاخیر بالایی را نسبت به سایر بسته‌ها تجربه می‌کنند.
۹۰ درصد بالای تاخیر برای نرخ ارسال ۱ و ۱۰ بسته بر ثانیه به تاخیر میانگین نزدیک است اما برای ارسال ۱۰۰ بسته در ثانیه فاصله زیادی (تقریبا دو برابر) تا تاخیر میانگین دارد که این امر
در شکل \رجوع{شکل: ۹۰٪ بالای تاخیر در ارزیابی کارایی سرور شبکه و اپلیکیشن LoRaWAN --- محک اول} دیده می‌شود.

\شروع{شکل}
\تنظیم‌ازوسط
\درج‌تصویر[width=\textwidth]{./simulation/s1/e1.png}
\شرح{نرخ از دست رفتن بسته، تاخیر میانیگن و ۹۰٪ بالای تاخیر در ارزیابی کارایی سرور شبکه و اپلیکیشن \متن‌لاتین{LoRaWAN} --- محک اول}
\برچسب{شکل: ارزیابی کارایی سرور شبکه و اپلیکیشن LoRaWAN --- محک اول}
\پایان{شکل}

\زیرقسمت{محک دوم}

همانطور که پیشتر هم اشاره شد یکی از ویژگی‌های برجسته شبکه‌های \متن‌لاتین{LoRaWAN} عدم وجود
همبستگی میان اشیا و دروازه‌ها است. در این شبکه‌ها داده اشیا توسط هر دروازه‌ای
که در ناحیه پوشش‌دهی باشد دریافت شده و برای سرور شبکه ارسال می‌شود.
در این سناریو قصد ارزیابی این مورد را داریم.
برای این سناریو تمامی اجزای شبیه‌سازی روی همین ماشین مجازی اجرا شده‌اند.

در این سناریو از یک ماشین محازی با هشت پردازنده مجازی از پردازنده فیزیکی
\متن‌لاتین{AMD Ryzen Threadripper 1950X}
و ۱۶ گیگابایت حافظه استفاده شد.
در این شبیه‌سازی سه دروازه شبیه‌سازی شده است که داده‌ی یک شی یکسان را گزارش می‌کنند. فاصله میان ارسال داده‌ها از ۱ ثانیه تا ۱ میلی‌ثانیه تغییر می‌کند.

در این سناریو با وجود اینکه بسته‌های تکراری در سرور شبکه حذف می‌شوند اما لود حاصل از این بسته‌ها باعث شده است تا در نرخ ارسال ۱۰۰۰ بسته در ثانیه
در این محک نسبت به محک اول بسته‌های از دست رفته داشته باشیم که این امر در شکل \رجوع{شکل: نرخ از دست رفتن بسته در ارزیابی کارایی سرور شبکه و اپلیکیشن LoRaWAN --- محک دوم}
مشهود است.

در بحث تاخیر، این دو محک تاخیر میانگین و ۹۰٪ بالای تاخیر مشابهی دارند البته بازه تغییرات در هر آزمایش در محک دو مقداری بیشتر از محک اول است
که گویا ناشی از بار بیشتر حاصل از پردازش بسته‌های بیشتر است.
تاخیر میانگین و ۹۰٪ بالای تاخیر در محک دوم در شکل‌های \رجوع{شکل: تاخیر میانگین در ارزیابی کارایی سرور شبکه و اپلیکیشن LoRaWAN --- محک دوم}
و \رجوع{شکل: ۹۰٪ بالای تاخیر در ارزیابی کارایی سرور شبکه و اپلیکیشن LoRaWAN --- محک دوم}
ارائه شده است.

\شروع{شکل}
\تنظیم‌ازوسط
\درج‌تصویر[width=\textwidth]{./simulation/s1/e2.png}
\شرح{نرخ از دست رفتن بسته، تاخیر میانیگن و ۹۰٪ بالای تاخیر در ارزیابی کارایی سرور شبکه و اپلیکیشن \متن‌لاتین{LoRaWAN} --- محک دوم}
\برچسب{شکل: ارزیابی کارایی سرور شبکه و اپلیکیشن LoRaWAN --- محک دوم}
\پایان{شکل}

\زیرقسمت{محک سوم}

همانطور که پیشتر هم بیان شد عموما دروازه‌ها در محیط عملیاتی قرار دارند و با سرورهایی که سرور شبکه
و اپلیکیشن را اجرا می‌کنند، فاصله دارند. از این رو در این محک از دو ماشین مجازی مجزا استفاده کرده و تاثیر آن را ارزیابی می‌کنیم.
این ماشین‌های مجازی متفاوت به واسطه‌ی شبکه‌ی \متن‌لاتین{1G} اترنت با یکدیگر ارتباط برقرار می‌کنند.

در این سناریو دو ماشین مجازی با هشت پردازنده مجازی از پردازنده فیزیکی
\متن‌لاتین{AMD Ryzen Threadripper 1950X}
و ۱۶ گیگابایت حافظه استفاده شد.
در این شبیه‌سازی یک دروازه شبیه‌سازی شده است که داده‌ی یک شی را گزارش می‌کنند. فاصله میان ارسال داده‌ها از ۱ ثانیه تا ۱۰ میلی‌ثانیه تغییر می‌کند.

در این سناریو با وجود جدا شدن سرویس‌ها، اما تاخیر شبکه‌ی اترنت محسوس نبوده و اعداد تقریبا مشابه با محک اول هستند.
(\رجوع{شکل: تاخیر میانگین در ارزیابی کارایی سرور شبکه و اپلیکیشن LoRaWAN --- محک سوم} \رجوع{شکل: ۹۰٪ بالای تاخیر در ارزیابی کارایی سرور شبکه و اپلیکیشن LoRaWAN --- محک سوم})
از دست رفت بسته رخ نداده است که این امر کاملا با محک اول هماهنگ است. (\رجوع{شکل: نرخ از دست رفتن بسته در ارزیابی کارایی سرور شبکه و اپلیکیشن LoRaWAN --- محک سوم})

\شروع{شکل}
\تنظیم‌ازوسط
\درج‌تصویر[width=\textwidth]{./simulation/s1/e3.png}
\شرح{نرخ از دست رفتن بسته، تاخیر میانیگن و ۹۰٪ بالای تاخیر در ارزیابی کارایی سرور شبکه و اپلیکیشن \متن‌لاتین{LoRaWAN} --- محک سوم}
\برچسب{شکل: ارزیابی کارایی سرور شبکه و اپلیکیشن LoRaWAN --- محک سوم}
\پایان{شکل}

\زیرقسمت{محک چهارم}

یکی از کاربردهای شبکه‌های \متن‌لاتین{LoRaWAN} استفاده آن در محیط‌هایی با چندین شی است و پژوهش‌های بسیاری به گسترش‌پذیری این شبکه‌ها پرداخته‌اند.
در این محک قصد داریم با تعداد اشیا بالا ارزیابی را انجام داده و تاثیر آن را بر پارامترهای مورد ارزیابی‌مان یعنی تاخیر و نرخ دریافت بسته مشاهده کنیم.

در این سناریو از یک ماشین محازی با هشت پردازنده مجازی از پردازنده فیزیکی
\متن‌لاتین{AMD Ryzen Threadripper 1950X}
و ۱۶ گیگابایت حافظه استفاده شد.
در این محک تعداد ۱۰۰ شی شبیه‌سازی شده‌اند که نرخ داده‌های متفاوتی را ارسال می‌کنند. به نظر می‌رسد با افزایش تعداد اشیا نسبت به محک‌ اول تاخیر بیشتر شده و بسته‌های بیشتری
از دست رفته‌اند. همانطور که در شکل \رجوع{شکل: نرخ دریافت بسته در ارزیابی کارایی سرور شبکه و اپلیکیشن LoRaWAN --- محک چهارم} مشهود است با افزایش نرخ ارسال داده در اشیا
تعداد بسیار زیادی از بسته‌ها، از دست می‌روند.
از سوی دیگر تاخیر نیز نسبت به محک اول افزایش داشته و با افزایش نرخ ارسال به صورت چشم‌گیری افزایش پیدا می‌کند
(\رجوع{شکل: تاخیر میانگین در ارزیابی کارایی سرور شبکه و اپلیکیشن LoRaWAN --- محک چهارم} \رجوع{شکل: ۹۰٪ بالای تاخیر در ارزیابی کارایی سرور شبکه و اپلیکیشن LoRaWAN --- محک چهارم}).
این محک نشان می‌دهد با افزایش تعداد اشیا زمان پردازش برای هر شی بیشتر شده است چرا که فاصله زمانی ۵۰۰ میلی‌ثانیه هم برای پردازش کافی نبوده و باعث از دست رفت بسته و
افزایش تاخیر شده است. با توجه به اهمیت این موضوع در محک پنجم، به صورت مشخص به ارزیابی تاثیر افزایش تعداد اشیا با ثابت نگاه داشتن نرخ ارسال پرداخته شده است.

\شروع{شکل}
\تنظیم‌ازوسط
\درج‌تصویر[width=\textwidth]{./simulation/s1/e4.png}
\شرح{نرخ از دست رفتن بسته، تاخیر میانیگن و ۹۰٪ بالای تاخیر در ارزیابی کارایی سرور شبکه و اپلیکیشن \متن‌لاتین{LoRaWAN} --- محک چهارم}
\برچسب{شکل: ارزیابی کارایی سرور شبکه و اپلیکیشن LoRaWAN --- محک چهارم}
\پایان{شکل}

\زیرقسمت{محک پنجم}

در این محک قصد داریم با ثابت نگاه داشتن نرخ ارسال بر ۵۰۰ میلی‌ثانیه، تعداد اشیا را افزایش دهیم و تاثیر آن را بر نرخ از دست رفتن بسته‌ها و تاخیر آن‌ها ارزیابی کنیم.
همانطور که در نمودارهای \رجوع{شکل: تاخیر میانگین در ارزیابی کارایی سرور شبکه و اپلیکیشن LoRaWAN --- محک پنجم}
و \رجوع{شکل: ۹۰٪ بالای تاخیر در ارزیابی کارایی سرور شبکه و اپلیکیشن LoRaWAN --- محک پنجم} مشخص است با افزایش تعداد اشیا تاخیر افزایش پیدا می‌کند.
در ادامه این افزایش تاخیر، نرخ دریافت بسته‌ها کاهش پیدا می‌کند (\رجوع{شکل: نرخ دریافت بسته در ارزیابی کارایی سرور شبکه و اپلیکیشن LoRaWAN --- محک پنجم}).

در این سناریو از یک ماشین محازی با هشت پردازنده مجازی از پردازنده فیزیکی
\متن‌لاتین{AMD Ryzen Threadripper 1950X}
و ۱۶ گیگابایت حافظه استفاده شد.

\شروع{شکل}
\تنظیم‌ازوسط
\درج‌تصویر[width=\textwidth]{./simulation/s1/e5.png}
\شرح{نرخ از دست رفتن بسته، تاخیر میانیگن و ۹۰٪ بالای تاخیر در ارزیابی کارایی سرور شبکه و اپلیکیشن \متن‌لاتین{LoRaWAN} --- محک پنجم}
\برچسب{شکل: ارزیابی کارایی سرور شبکه و اپلیکیشن LoRaWAN --- محک پنجم}
\پایان{شکل}

\زیرقسمت{محک ششم}

در این محک قصد داریم با ثابت نگاه داشتن نرخ ارسال بر ۵۰۰ میلی‌ثانیه و تعداد ۱۰۰ شی، تعداد دروازهها را افزایش دهیم و تاثیر آن را بر نرخ از دست رفتن بسته‌ها و تاخیر آن‌ها ارزیابی کنیم.
با افزایش دروازهها اشیا را به صورت مساوی بین آن‌ها تقسیم می‌کنیم و هر شی تنها با یک دروازه در ارتباط خواهد بود.
همانطور که در شکل \رجوع{شکل: نرخ دریافت بسته در ارزیابی کارایی سرور شبکه و اپلیکیشن LoRaWAN --- محک ششم} مشخص است
با افزایش تعداد دروازهها نرخ از دست رفت بسته‌ها به طور چشم‌گیری کاهش پیدا می‌کند، بنابراین افزایش تعداد دروازهها نه تنها
به افزایش پوشش شبکه و دریافت بهتر بسته‌ها در لایه فیزیکی کمک می‌کند بلکه باعث کاهش از دست رفت بسته‌ها در شبکه هسته نیز می‌شود.

در این سناریو از یک ماشین محازی با هشت پردازنده مجازی از پردازنده فیزیکی
\متن‌لاتین{AMD Ryzen Threadripper 1950X}
و ۱۶ گیگابایت حافظه استفاده شد.

\شروع{شکل}
\تنظیم‌ازوسط
\درج‌تصویر[width=\textwidth]{./simulation/s1/e6.png}
\شرح{نرخ از دست رفتن بسته، تاخیر میانیگن و ۹۰٪ بالای تاخیر در ارزیابی کارایی سرور شبکه و اپلیکیشن \متن‌لاتین{LoRaWAN} --- محک ششم}
\برچسب{شکل: ارزیابی کارایی سرور شبکه و اپلیکیشن LoRaWAN --- محک ششم}
\پایان{شکل}

\زیرقسمت{محک هفتم}

در این محک قصد داریم محک ششم را در شرایط واقعی‌تر تکرار کنیم. با توجه به آنچه که پیشتر هم بیان شد، داده‌ی اشیا در \متن‌لاتین{LoRaWAN}
ممکن است توسط چند دروازه دریافت و به سرور شبکه ارسال شود. در این محک قصد داریم با اضافه کردن این مورد شرایط واقعی‌تری را شبیه‌سازی کنیم،
به این شکل داده‌ی یک شی به صورت تصادفی در طول شبیه‌سازی توسط یک، دو یا سه دروازه ارسال می‌گردد.
تعداد اشیا برابر ۱۰۰ بوده و نرخ ارسال ۵۰۰ میلی‌ثانیه است.

در این سناریو از یک ماشین محازی با هشت پردازنده مجازی از پردازنده فیزیکی
\متن‌لاتین{AMD Ryzen Threadripper 1950X}
و ۱۶ گیگابایت حافظه استفاده شد.

در شکل \رجوع{شکل: نرخ دریافت بسته در ارزیابی کارایی سرور شبکه و اپلیکیشن LoRaWAN --- محک هفتم}
مشخص است با افزایش تعداد دروازهها نرخ دریافت بسته افزایش پیدا می‌کند اما یک نقطه به بعد
افزایش دروازهها باعث کاهش نرخ دریافت بسته می‌شود.

همانطور که در شکل‌های \رجوع{شکل: تاخیر میانگین در ارزیابی کارایی سرور شبکه و اپلیکیشن LoRaWAN --- محک هفتم}
و \رجوع{شکل: ۹۰٪ بالای تاخیر در ارزیابی کارایی سرور شبکه و اپلیکیشن LoRaWAN --- محک هفتم}
مشخص است تاخیر با تغییر تعداد دروازهها مقدار زیادی تغییر نمی‌کند.

\شروع{شکل}
\تنظیم‌ازوسط
\درج‌تصویر[width=\textwidth]{./simulation/s1/e7.png}
\شرح{نرخ از دست رفتن بسته، تاخیر میانیگن و ۹۰٪ بالای تاخیر در ارزیابی کارایی سرور شبکه و اپلیکیشن \متن‌لاتین{LoRaWAN} --- محک هفتم}
\برچسب{شکل: ارزیابی کارایی سرور شبکه و اپلیکیشن LoRaWAN --- محک هفتم}
\پایان{شکل}
